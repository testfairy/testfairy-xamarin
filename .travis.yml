language: objective-c
osx_image: xcode10.2

before_install:
- brew tap AdoptOpenJDK/openjdk
- brew cask install adoptopenjdk8
- ls /Library/Java/JavaVirtualMachines/
- export JAVA_HOME=/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home
- wget http://dl.google.com/android/android-sdk_r24.4.1-macosx.zip
- unzip android-sdk_r24.4.1-macosx.zip
- export ANDROID_HOME=$PWD/android-sdk-macosx
- export PATH=${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools:${ANDROID_HOME}/build-tools/23.0.3/aapt
- echo yes | android update sdk --filter platform-tools --no-ui --force > /dev/null
- echo yes | android update sdk --filter android-23 --no-ui --force > /dev/null
- echo yes | android update sdk --filter android-15 --no-ui --force > /dev/null
- echo yes | android update sdk --filter build-tools-23.0.3 --all --no-ui --force > /dev/null
- echo yes | android update sdk --filter sysimg-23 --no-ui --force > /dev/null
- echo yes | android update sdk --filter extra-android-support --no-ui --force > /dev/null
- echo yes | android update sdk --filter extra-android-m2repository --no-ui --force > /dev/null

install:
  - make install

script:
  - make

after_deploy:
  - /Library//Frameworks//Mono.framework/Versions/6.8.0/bin/mono nuget.exe setApiKey ${NUGET_API_KEY} -Source https://www.nuget.org/api/v2/package
  - /Library//Frameworks//Mono.framework/Versions/6.8.0/bin/mono nuget.exe push output/TestFairy.Xamarin.${TRAVIS_TAG}.nupkg -Source https://www.nuget.org/api/v2/package
  
deploy:
  provider: releases
  api_key:
    secure: zyI2NhevUN1xNI7I7Dfs2zFQoBtBeGKx5Ooj6lE/m1PgW7+MWbFzzgTQiNIbIQ7S9YkBlLYPYRdzTbiBMvuMCwzS17evQzoqcxEMiusJN46X0cPlDL/Z81CdGWbvKkYkHCeezoU9wZJuOSsmI7x/uL8cCR/MTFoqGZFSvNc1FUY=
  file: 
    - output/TestFairy.Xamarin.${TRAVIS_TAG}.nupkg
    - output/TestFairy.Xamarin-iOS.${TRAVIS_TAG}.zip
    - output/TestFairy.Xamarin-Android.${TRAVIS_TAG}.zip
  skip_cleanup: true
  on:
    tags: true

